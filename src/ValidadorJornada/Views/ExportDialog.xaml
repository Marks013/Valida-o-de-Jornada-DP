<Window x:Class="ValidadorJornada.Views.ExportDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:ValidadorJornada.Converters"
        Title="Gerar Documento de Jornadas" 
        Height="750" Width="700"
        MinHeight="750" MinWidth="700"
        ResizeMode="CanResize" 
        WindowStartupLocation="CenterOwner"
        Background="#FAFAFA">
    
    <Window.Resources>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolConverter"/>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
    </Window.Resources>
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Título -->
        <TextBlock Grid.Row="0" 
                   Text="📄 Gerar Documento de Jornadas" 
                   FontSize="16" 
                   FontWeight="Bold" 
                   Foreground="#2C3E50"
                   Margin="0,0,0,15"/>

        <!-- Data Global -->
        <StackPanel Grid.Row="1" Margin="0,0,0,15">
            <CheckBox IsChecked="{Binding UsarDataGlobal}"
                      Content="Usar mesma data para TODOS os colaboradores"
                      FontSize="12"
                      FontWeight="SemiBold"
                      Margin="0,0,0,10"/>
            
            <DatePicker SelectedDate="{Binding DataGlobal}"
                        IsEnabled="{Binding UsarDataGlobal}"
                        Padding="10"
                        FontSize="13"
                        Background="White"
                        BorderBrush="#BDBDBD"
                        BorderThickness="2"/>
        </StackPanel>

        <!-- Lista de Jornadas -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Margin="0,0,0,15">
            <ItemsControl ItemsSource="{Binding Jornadas}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="#2196F3" 
                                BorderThickness="2" 
                                CornerRadius="8" 
                                Padding="15" 
                                Margin="0,0,0,15"
                                Background="White">
                            <StackPanel>
                                <!-- Header Jornada -->
                                <Border Background="#E3F2FD" Padding="12" CornerRadius="6" Margin="0,0,0,10">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Jornada}" FontSize="13" FontWeight="Bold" Foreground="#1976D2"/>
                                        <TextBlock FontSize="11" Foreground="#666" Margin="0,3,0,0"
                                                   Visibility="{Binding Codigo, Converter={StaticResource StringToVisibilityConverter}}">
                                            <Run Text="Código: "/><Run Text="{Binding Codigo}"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                                
                                <!-- Data Local (visível se global = false) -->
                                <StackPanel Margin="0,0,0,10"
                                            Visibility="{Binding DataContext.UsarDataGlobal, 
                                                        RelativeSource={RelativeSource AncestorType=Window}, 
                                                        Converter={StaticResource InverseBoolConverter}}">
                                    <CheckBox IsChecked="{Binding UsarDataUnicaLocal}"
                                              Content="Mesma data para todos desta jornada"
                                              FontSize="11" Margin="0,0,0,8"/>
                                    <DatePicker SelectedDate="{Binding DataUnicaLocal}"
                                                IsEnabled="{Binding UsarDataUnicaLocal}"
                                                Padding="8" FontSize="12" Background="White"
                                                BorderBrush="#BDBDBD" BorderThickness="1"/>
                                </StackPanel>
                                
                                <!-- Header Colaboradores -->
                                <Border Background="#F5F5F5" Padding="10" CornerRadius="4" Margin="0,0,0,10">
                                    <Grid>
                                        <TextBlock VerticalAlignment="Center" FontWeight="SemiBold" FontSize="11">
                                            <Run Text="Colaboradores ("/><Run Text="{Binding Colaboradores.Count, Mode=OneWay}"/><Run Text=")"/>
                                        </TextBlock>
                                        <Button Content="+ Adicionar" 
                                                Command="{Binding DataContext.AdicionarColaboradorCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}"
                                                HorizontalAlignment="Right"
                                                Background="#4CAF50" Foreground="White"
                                                Padding="10,5" BorderThickness="0" Cursor="Hand"
                                                FontSize="10" FontWeight="SemiBold">
                                            <Button.Style>
                                                <Style TargetType="Button">
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate TargetType="Button">
                                                                <Border Background="{TemplateBinding Background}" CornerRadius="4" Padding="{TemplateBinding Padding}">
                                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                </Border>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#388E3C"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                        </Button>
                                    </Grid>
                                </Border>
                                
                                <!-- Lista Colaboradores -->
                                <ItemsControl ItemsSource="{Binding Colaboradores}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" 
                                                    Padding="10" Margin="0,0,0,8" Background="#FAFAFA">
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    
                                                    <!-- Botão Remover -->
                                                    <Button Grid.Row="0" Grid.Column="1" Content="🗑" 
                                                            Click="BtnRemoverColaborador_Click" Tag="{Binding}"
                                                            Background="Transparent" BorderThickness="0"
                                                            Foreground="#E74C3C" Cursor="Hand" FontSize="14"
                                                            ToolTip="Remover colaborador" Margin="0,-5,-5,0" Padding="5"/>
                                                    
                                                    <!-- Matrícula -->
                                                    <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,0,5">
                                                        <TextBlock Text="Matrícula" FontSize="9" FontWeight="Bold" Foreground="#616161" Margin="0,0,0,2"/>
                                                        <TextBox Text="{Binding Matricula, UpdateSourceTrigger=PropertyChanged}"
                                                                 Padding="5" FontSize="10" Background="White" BorderBrush="#BDBDBD" BorderThickness="1"/>
                                                    </StackPanel>
                                                    
                                                    <!-- Nome -->
                                                    <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,0,5">
                                                        <TextBlock Text="Nome" FontSize="9" FontWeight="Bold" Foreground="#616161" Margin="0,0,0,2"/>
                                                        <TextBox Text="{Binding Nome, UpdateSourceTrigger=PropertyChanged}"
                                                                 Padding="5" FontSize="10" Background="White" BorderBrush="#BDBDBD" BorderThickness="1"/>
                                                    </StackPanel>
                                                    
                                                    <!-- Cargo -->
                                                    <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,0,5">
                                                        <TextBlock Text="Cargo" FontSize="9" FontWeight="Bold" Foreground="#616161" Margin="0,0,0,2"/>
                                                        <TextBox Text="{Binding Cargo, UpdateSourceTrigger=PropertyChanged}"
                                                                 Padding="5" FontSize="10" Background="White" BorderBrush="#BDBDBD" BorderThickness="1"/>
                                                    </StackPanel>
                                                    
                                                    <!-- Data Individual -->
                                                    <StackPanel Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" x:Name="pnlDataIndividual">
                                                        <TextBlock Text="Data da Alteração" FontSize="9" Foreground="#616161" Margin="0,0,0,2"/>
                                                        <DatePicker SelectedDate="{Binding DataAlteracao, UpdateSourceTrigger=PropertyChanged}"
                                                                   Padding="5" FontSize="10" Background="White" BorderBrush="#BDBDBD" BorderThickness="1"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                            <DataTemplate.Triggers>
                                                <!-- Oculta se Data Global ativada -->
                                                <DataTrigger Binding="{Binding DataContext.UsarDataGlobal, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                                    <Setter TargetName="pnlDataIndividual" Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                                <!-- Oculta se Data Local da Jornada ativada -->
                                                <DataTrigger Binding="{Binding DataContext.UsarDataUnicaLocal, RelativeSource={RelativeSource AncestorType=Border, AncestorLevel=2}}" Value="True">
                                                    <Setter TargetName="pnlDataIndividual" Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </DataTemplate.Triggers>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Info -->
        <Border Grid.Row="3" Background="#E3F2FD" BorderBrush="#2196F3" BorderThickness="2" 
                CornerRadius="6" Padding="10" Margin="0,0,0,15">
            <Grid>
                <TextBlock Text="ℹ️ Informações sobre o documento" FontSize="11" FontWeight="SemiBold" 
                           Foreground="#1976D2" VerticalAlignment="Center"/>
                <Border Width="22" Height="22" HorizontalAlignment="Right" Background="#2196F3" 
                        CornerRadius="11" Cursor="Help" ToolTipService.InitialShowDelay="200" ToolTipService.ShowDuration="30000">
                    <Border.ToolTip>
                        <ToolTip MaxWidth="450" Background="#2C3E50" Foreground="White" Padding="15">
                            <StackPanel>
                                <TextBlock Text="📄 Instruções de Preenchimento" FontWeight="Bold" FontSize="13" Margin="0,0,0,10"/>
                                <TextBlock x:Name="txtInstrucoes" TextWrapping="Wrap" FontSize="11" LineHeight="18"
                                           Text="• Múltiplos horários, cada um com seus colaboradores&#x0a;• Adicione colaboradores a cada horário individualmente&#x0a;• O PDF será salvo na área de Trabalho&#x0a;• Campos vazios terão espaço para preenchimento manual"/>
                            </StackPanel>
                        </ToolTip>
                    </Border.ToolTip>
                    <TextBlock Text="?" Foreground="White" FontWeight="Bold" FontSize="14"
                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Border>
            </Grid>
        </Border>

        <!-- Botões -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Cancelar" x:Name="btnCancelar" Padding="20,10" Margin="0,0,10,0"
                    Click="BtnCancelar_Click" Background="White" Foreground="#616161"
                    BorderBrush="#BDBDBD" BorderThickness="2" Cursor="Hand">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="6" Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#F5F5F5"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Button.Style>
            </Button>
            
            <Button Content="📄 Gerar PDF" x:Name="btnGerar" Padding="20,10" Click="BtnGerar_Click"
                    Background="#2196F3" Foreground="White" BorderThickness="0" FontWeight="SemiBold" Cursor="Hand">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" Background="{TemplateBinding Background}"
                                            CornerRadius="6" Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#1976D2"/>
                                        </Trigger>
                                        <Trigger Property="IsEnabled" Value="False">
                                            <Setter TargetName="border" Property="Background" Value="#BDBDBD"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>
    </Grid>
</Window>
